<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Workday Countdown</title>

    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="stylesheet" href="styles.css" />
    <!-- Pickr Color Picker -->
    <link rel="stylesheet" href="https://unpkg.com/@simonwep/pickr@1.8.2/dist/themes/monolith.min.css"/>
    <link rel="stylesheet" href="pickr-custom.css" />
  </head>


  <body>
    <!-- Load SVG sprite -->
    <script>
      // Load SVG sprite from external file
      (async function() {
        try {
          const response = await fetch('./icons/sprite.svg');
          const svgText = await response.text();
          const div = document.createElement('div');
          div.innerHTML = svgText;
          document.body.insertBefore(div.firstChild, document.body.firstChild);
        } catch (error) {
          console.error('Failed to load SVG sprite:', error);
        }
      })();
    </script>

    <header>
      <div class="brand">
        <svg aria-hidden="true"><use href="#icon-clock"></use></svg>
        <span>Workday Countdown</span>
      </div>
    </header>

    <main class="center" role="main" aria-label="Countdown timer">
      <div class="stack">
        <!-- Dual countdowns -->
        <div id="countdownBig" class="countdown-big" role="timer" aria-live="polite">–:–</div>
        <div id="labelBig" class="subtitle" aria-live="polite">…</div>

        <div id="countdownSmall" class="countdown-small" role="timer" aria-live="polite">–:–</div>
        <div id="labelSmall" class="subtitle" aria-live="polite">…</div>

        <div class="progress-wrap" aria-label="Work progress">
          <div
            class="progress"
            id="progress"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="0"
            aria-label="Work day progress"
          >
            <div class="bar" id="progressBar"></div>
          </div>
          <div class="progress-meta" aria-label="Time range">
            <span id="progressStart" aria-label="Start time">–:–</span>
            <span id="progressNow" aria-label="Current time"></span>
            <span id="progressEnd" aria-label="End time">–:–</span>
          </div>
        </div>
      </div>
    </main>

    <footer role="contentinfo">
      <div class="footer-settings" role="navigation" aria-label="Settings">
        <button class="setting-btn" id="layoutBtn" title="Toggle display mode" aria-label="Toggle display mode">
          <svg aria-hidden="true" width="16" height="16"><use href="#icon-grid"></use></svg>
          <span id="layoutLabel">total</span>
        </button>
        <button class="setting-btn" id="rulesBtn" title="Manage rules" aria-label="Manage work rules">
          <svg aria-hidden="true" width="16" height="16"><use href="#icon-calendar"></use></svg>
          <span>rules</span>
        </button>
        <button class="setting-btn" id="notificationsBtn" title="Notification settings" aria-label="Configure notifications">
          <svg aria-hidden="true" width="16" height="16"><use href="#icon-bell"></use></svg>
          <span>notifications</span>
        </button>
        <!-- Theme Selector -->
        <button class="setting-btn" id="themeBtn" title="Select theme" aria-label="Select color theme">
          <svg aria-hidden="true" width="16" height="16"><use href="#icon-sliders"></use></svg>
          <span id="themeLabel">theme</span>
        </button>
        <button class="setting-btn" id="themeEditorBtn" title="Open Theme Editor" aria-label="Open theme editor" style="display: none;">
          <svg aria-hidden="true" width="16" height="16"><use href="#icon-sliders"></use></svg>
          <span>editor</span>
        </button>
      </div>
    </footer>

    <!-- Settings Overlay (Simplified) -->
    <div class="overlay" id="overlay" aria-hidden="true">
      <section
        class="panel simple-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="panelTitle"
      >
        <div class="panel-header">
          <h3 id="panelTitle">settings</h3>
          <button class="close-btn" id="closePanel" aria-label="Close">×</button>
        </div>

        <div class="simple-settings" id="settingsContent">
          <!-- Content loaded dynamically based on which button was clicked -->
        </div>
      </section>
    </div>

    <!-- Welcome Popup -->
    <div class="overlay" id="welcomeOverlay" aria-hidden="true">
      <section
        class="panel welcome-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="welcomeTitle"
      >
        <div class="panel-header">
          <h3 id="welcomeTitle">Welcome</h3>
          <button class="close-btn" id="closeWelcome" aria-label="Close">×</button>
        </div>
        <div class="welcome-content" id="welcomeContent">
          <!-- Markdown content will be loaded here -->
        </div>
      </section>
    </div>

    <script src="src/markdownParser.js"></script>
    <!-- Theme Editor Modal -->
    <div class="overlay" id="themeEditorOverlay" aria-hidden="true">
      <section
        class="panel theme-editor-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="themeEditorTitle"
      >
        <div class="panel-header">
          <h3 id="themeEditorTitle">theme editor</h3>
          <button class="close-btn" id="closeThemeEditor" aria-label="Close">×</button>
        </div>

        <div class="theme-editor-content">
          <!-- Theme List -->
          <div class="theme-list-section">
            <h4>available themes</h4>
            <div id="themeList" class="theme-list">
              <!-- Themes will be rendered here -->
            </div>
          </div>

          <!-- Theme Editor Form -->
          <div class="theme-form-section">
            <h4 id="themeFormTitle">create new theme</h4>
            <form id="themeEditorForm" class="theme-form">
              <div class="form-group">
                <label for="themeName">Theme Name</label>
                <input type="text" id="themeName" class="simple-input" placeholder="My Custom Theme" required>
              </div>

              <div class="form-group">
                <label for="bgColor">Background Color</label>
                <div class="color-input-group">
                  <div id="bgColor" class="color-picker-container"></div>
                  <input type="text" id="bgColorText" class="simple-input color-text" value="#323437">
                </div>
              </div>

              <div class="form-group">
                <label for="fgColor">Text Color</label>
                <div class="color-input-group">
                  <div id="fgColor" class="color-picker-container"></div>
                  <input type="text" id="fgColorText" class="simple-input color-text" value="#d1d0c5">
                </div>
              </div>

              <div class="form-group">
                <label for="accentColor">Accent Color</label>
                <div class="color-input-group">
                  <div id="accentColor" class="color-picker-container"></div>
                  <input type="text" id="accentColorText" class="simple-input color-text" value="#e2b714">
                </div>
              </div>

              <div class="form-group">
                <label for="accent2Color">Accent 2 Color</label>
                <div class="color-input-group">
                  <div id="accent2Color" class="color-picker-container"></div>
                  <input type="text" id="accent2ColorText" class="simple-input color-text" value="#e2b714">
                </div>
              </div>

              <div class="form-group">
                <label for="mutedColor">Muted Color</label>
                <div class="color-input-group">
                  <div id="mutedColor" class="color-picker-container"></div>
                  <input type="text" id="mutedColorText" class="simple-input color-text" value="#646669">
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="simple-btn" id="previewThemeBtn">Preview</button>
                <button type="submit" class="simple-btn active" id="saveThemeBtn">Save Theme</button>
                <button type="button" class="simple-btn" id="cancelThemeBtn">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </section>
    </div>

    <!-- Pickr Color Picker -->
    <script src="https://unpkg.com/@simonwep/pickr@1.8.2/dist/pickr.min.js"></script>
    
    <script src="themes.js"></script>
    <script src="themeEditor.js"></script>
    <script src="script.js"></script>
    <script>
      // Initialize theme system on page load
      document.addEventListener('DOMContentLoaded', async () => {
        // Initialize the new theme system
        await window.ThemeSystem.initThemeSystem();
        
        // Update theme label in footer after theme is loaded
        if (typeof updateThemeLabel === 'function') {
          updateThemeLabel();
        }
        
        // Initialize theme editor
        initThemeEditor();
      });
    </script>
  </body>
</html>
